<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tafeltennis club De Pinte</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='header.css') }}">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        header {
            height: 200px;
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--primary-blue);
            color: var(--primary-yellow);
            text-align: center;
            font-size: 3.5em;
            font-weight: bold;
            padding: 75px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
        }

        .search-bar {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .search-bar input[type="text"] {
            width: 300px;
            padding: 10px;
            font-size: 1em;
            border: 2px solid var(--primary-blue);
            border-radius: 20px;
            outline: none;
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }

        .featured-item {
            background-color: var(--neutral-light);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .featured-item:hover {
            transform: translateY(-5px);
        }

        .featured-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .featured-item h3 {
            color: var(--primary-blue);
            margin-bottom: 10px;
        }
        .news-title {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid var(--primary-yellow);
            padding-bottom: 0px;
            display: inline-block;
            font-weight: bold;
            cursor: pointer;
        }

        #top-activities {
            margin: 20px 20px;
        }

        #top-activities h2 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid var(--primary-yellow);
            padding-bottom: 10px;
            display: inline-block;
        }

        #top-activities .activity-item {
            position: relative;
            border-bottom: 1px solid #ddd;
            padding: 20px 0;
            transition: background-color 0.2s;
            text-decoration: none; /* Remove underline from links */
        }

        #top-activities a {
            text-decoration: none; /* Remove default underline for links */
            color: inherit; /* Inherit text color */
            display: block; /* Ensure the entire item is clickable */
        }

        #top-activities .activity-item:hover {
            background-color: var(--secondary-yellow);
            padding: 20px;
            border-radius: 8px;
        }

        #top-activities .activity-item:hover h3 {
            color: var(--neutral-dark); /* Keep the title black */
        }

        #top-activities .activity-item:hover .date,
        #top-activities .activity-item:hover p {
            color: var(--neutral-gray); /* Keep the date and details gray */
        }


        #top-activities .activity-item h3,
        #top-activities .activity-item .date,
        #top-activities .activity-item p {
            cursor: pointer;
        }

        #top-activities .activity-item h3:focus,
        #top-activities .activity-item .date:focus,
        #top-activities .activity-item p:focus {
            outline: 2px solid var(--primary-blue);
            background-color: var(--neutral-light);
        }

        #top-activities .activity-item h3 {
            color: var(--neutral-dark);
            margin-bottom: 10px;
        }

        #top-activities .activity-item .date {
            color: var(--neutral-gray);
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        #top-activities .activity-item p {
            color: var(--neutral-gray);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 1; /* Show only one line */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            /* REMOVED: white-space: nowrap; */
        }

        .events-section {
            margin: 40px 0;
            background-color: var(--neutral-light);
            padding: 30px;
            border-radius: 10px;
        }

        .events-section h2 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid var(--primary-yellow);
            padding-bottom: 10px;
            display: inline-block;
        }

        .event-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .event-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .event-card:hover {
            transform: translateY(-5px);
        }

        .event-card h3 {
            color: var(--primary-blue);
            margin-bottom: 10px;
        }

        .event-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .event-info {
            color: var(--neutral-gray);
            margin-bottom: 5px;
        }

        .sponsors {
            background-color: var(--neutral-dark);
            padding: 40px;
            text-align: center;
            height: 500px;
        }

        .sponsors h2 {
            color: var(--primary-yellow);
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid var(--primary-yellow);
            padding-bottom: 10px;
            display: inline-block;
        }

        .sponsor-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 70px;
        }

        .sponsor-image {
            width: 200px;
            height: 200px;
            background-color: white;
            padding: 12px;
            border-radius: 8px;
            object-fit: contain;
            transition: transform 0.2s;
        }

        .sponsor-image:hover {
            transform: scale(1.05);
        }

        .button {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-blue);
            color: var(--primary-yellow);
            text-decoration: none;
            border-radius: 5px;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .button:hover {
            background-color: var(--secondary-blue);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .featured-grid, .event-grid {
                grid-template-columns: 1fr;
            }

            header {
                font-size: 2.5em;
                padding: 50px;
            }
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        /* New About Section */
        .about-section {
            background-color: white;
            padding: 60px 20px;
        }

        .about-content {
            padding-top: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .about-content h2 {
            color: var(--primary-blue);
            font-size: 2em;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--primary-yellow);
            padding-bottom: 10px;
            display: inline-block;
        }

        .contact-footer {
            background-color: #323232;
            color: #fff;
            padding: 50px 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .footer-container {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }

        .footer-map, .footer-contact {
            flex: 1 1 calc(50% - 20px);
            display: flex;
            flex-direction: column;
        }

        .footer-map iframe {
            border-radius: 12px;
            flex: 1;
        }

        .footer-contact h3 {
            margin-bottom: 30px;
        }

        .footer-contact form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .footer-contact input, .footer-contact textarea {
            padding: 10px;
            border: none;
            border-radius: 5px;
        }

        .footer-contact button {
            background-color: #ff6600;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .footer-contact button:hover {
            background-color: #cc5200;
        }


        /* Board Members Section */
        .board-section {
            background-color: var(--primary-blue);
            padding: 60px 20px;
            color: white;
        }

        .board-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .board-content h2 {
            font-size: 2em;
            margin-bottom: 40px;
            border-bottom: 3px solid var(--primary-yellow);
            padding-bottom: 10px;
            display: inline-block;
        }

        .board-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }

        .board-member {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            transition: transform 0.2s;
        }

        .board-member a {
            color: #00EC08;
        }

        .board-member:hover {
            transform: translateY(-5px);
        }

        .board-member img {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid var(--primary-yellow);
        }

        .board-member h3 {
            color: var(--primary-yellow);
            margin-bottom: 10px;
        }

        .board-member p {
            color: white;
            line-height: 1.6;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .site-title {
                font-size: 2em;
                padding: 20px;
            }

            .nav-links {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .auth-buttons {
                position: static;
                justify-content: center;
                padding: 10px;
            }

            .board-grid {
                grid-template-columns: 1fr;
            }
        }

        contact: {
            background-color: var(--neutral-dark)
            width: 100%;
            height: 75px;
        }

        .preview-area {
          width: 100%;
          min-height: 70vh;
          height: auto;
          border: 1px solid #DDDDDD;
          margin: 60px auto;
          font-family: inherit;
          font-size: 16px;
          line-height: 1.5;
          overflow-wrap: break-word;
          overflow-y: hidden;
        }

        .preview-area img,
        .preview-area2 img {
          max-width: var(--image-max-size, 300px);
          max-height: var(--image-max-size, 300px);
          width: auto;
          height: auto;
        }

        .preview-area[placeholder]:empty:before,
        .preview-area2 [placeholder]:empty:before{
          content: attr(placeholder);
          color: #999;
          pointer-events: none;
        }

        .preview-area:focus,
        .preview-area2:focus {
          outline: none;
          border-color: #6c5ce7;
          box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.2);
        }
        
        .preview-area a,
        .preview-area2 a {
            color: #0000EE; /* Typical link blue */
            text-decoration: underline;
            background-color: transparent;
            font-weight: normal;
            font-style: normal;
            font-size: inherit;
            font-family: inherit;
        }

        .preview-area a:visited,
        .preview-area2 a:visited {
            color: #551A8B; /* Typical visited link purple */
        }

        .preview-area a:hover {
            color: #FF0000; /* Red on hover */
            text-decoration: underline;
        }

        .preview-area a:active,
        .preview-area2 a:active {
            color: #FF0000; /* Red when active */
        }

        /* Add this to prevent other styles from affecting links */
        .preview-area a span,
        .preview-area2 a span {
            color: inherit !important;
            text-decoration: inherit !important;
            background-color: inherit !important;
            font-weight: inherit !important;
            font-style: inherit !important;
            font-size: inherit !important;
            font-family: inherit !important;
        }

        .preview-area2 {
            width: 100%;
            max-height: 40vh;
            min-height: 20vh;
            height: auto;
            margin: 60px auto;
            font-family: inherit;
            font-size: 16px;
            line-height: 1.5;
            overflow-wrap: break-word;
            overflow-y: hidden;
        }

    </style>
</head>
<body>
    <div class="header-container">
      <div class="header-main">
        <div class="auth-buttons">
          <a href="#" class="auth-button login">Log In</a>
          <a href="#" class="auth-button register">Register</a>
        </div>
        <a href="/" class="site-title">Tafeltennis club De Pinte</a>
      </div>
      <nav>
        <div class="nav-links">
          <a href="{{ url_for('home') }}">Home</a>
          <a href="{{ url_for('info') }}">Info</a>
          <a href="{{ url_for('home') }}#competition">Competition</a>
          <a href="{{ url_for('activities') }}">News</a>
          <a href="{{ url_for('home') }}#contact">Contact</a>
          <a href="{{ url_for('training') }}">Training</a>
        </div>
      </nav>
    </div>

    <div style="display: flex;
                max-width: 1400px;
                margin: 0 auto;
                background-color: #ffffff;
                padding: 20px;
                margin-top: 40px;">
        <!-- Content Area -->
        <div class="preview-area" id="previewText">
            {{ content|safe }}
        </div>

        <div class="content" style=" margin-left: 40px;">
            <div class="featured-grid" id="training">
                <div class="featured-item">
                    <div class="js-image" data-img-key="TTCjeugd"></div>
                    <h3>Training Sessions</h3>
                    <p>Join our professional coaching sessions for all skill levels</p>
                    <a href="#" class="button">Learn More</a>
                </div>
                <div class="featured-item">
                    <div class="js-image" data-img-key="volwassenen"></div>
                    <h3>Club Championships</h3>
                    <p>Compete in our monthly club championships</p>
                    <a href="#" class="button">Register Now</a>
                </div>
            </div>

            <div class="news-section" id="news">
                <div class="news-title" role="button" tabindex="0" onclick="/activities">News</div>
                <div id="top-activities">
                    <!-- Top activities will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </div>
    <div class="content">
        <div class="events-section" id="competition">
            <h2>Latest Match Results</h2>
            <div class="event-grid">
                {% for match, url in matches %}
                    <div class="event-card">
                        <a href="{{ url }}" target="_blank" class="event-link">
                            <div>
                                <p>{{ match[1] }} vs {{ match[2] }}</p>
                                <p>Score: {{ match[3] }}</p>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="sponsors" id="sponsors">
        <h2>Our Sponsors</h2>
        <div class="sponsor-grid">
            <div class="js-image" data-img-key="sponsor_1"></div>
            <div class="js-image" data-img-key="sponsor_2"></div>
            <div class="js-image" data-img-key="sponsor_3"></div>
            <div class="js-image" data-img-key="sponsor_4"></div>
            <div class="js-image" data-img-key="sponsor_5"></div>
            <div class="js-image" data-img-key="sponsor_6"></div>
            <div class="js-image" data-img-key="sponsor_7"></div>
        </div>
    </div>
    <div class="about-content">
        <h2>About us</h2>
        <div class="preview-area2" id="previewText2">
            {{ content_about|safe }}
        </div>
    </div>
    <div class="board-section">
        <div class="board-content">
            <h2>Our Board</h2>
            <div class="board-grid">
                <div class="board-member">
                    <div class="js-image" data-img-key="board_1"></div>
                    <h3>Johan Demolder</h3>
                    <p>Voorzitter</p>
                    <p>Telefoon: 09/281.03.21 - GSM : 0472/69.34.10</p>
                    <p>E-mailadres: <a href="mailto:voorzitter@ttcdepinte.be">voorzitter@ttcdepinte.be</a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_2"></div>
                    <h3>Rudy Morel</h3>
                    <p>Ondervoorzitter, materiaalmeester</p>
                    <p>GSM : 0477/46.79.46</p>
                    <p>E-mailadres: <a href="mailto: ondervoorzitter@ttcdepinte.be"> ondervoorzitter@ttcdepinte.be </a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_3"></div>
                    <h3>Roland Van Eeckhout</h3>
                    <p>Secretaris</p>
                    <p>Telefoon: 09/282.87.08 - GSM : 0495.80.15.88</p>
                    <p>E-mailadres: <a href="mailto: secretaris@ttcdepinte.be"> secretaris@ttcdepinte.be</a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_4"></div>
                    <h3>David Mussche</h3>
                    <p>Communicatieverantwoordelijke en Quiz</p>
                    <p>GSM : 0478/75.22.06</p>
                    <p>E-mailadres: <a href="mailto:info@ttcdepinte.be">info@ttcdepinte.be</a>,<a href="mailto:quiz@ttcdepinte.be">quiz@ttcdepinte.be</a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_5"></div>
                    <h3>Felix Declercq</h3>
                    <p>Penningmeester</p>
                    <p>Telefoon: 09/388.67.85 - GSM : 0474/44.57.90</p>
                    <p>E-mailadres: <a href="mailto:penningmeester@ttcdepinte.be">penningmeester@ttcdepinte.be</a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_6"></div>
                    <h3>Benny Moonen</h3>
                    <p>Jeugverantwoordelijke (Competitie), eetfestijn</p>
                    <p>GSM : 0474/98.66.31</p>
                    <p>E-mailadres: <a href="mailto:jeugdverantwoordelijke@ttcdepinte.be">jeugdverantwoordelijke@ttcdepinte.be</a>, <a href="mailto:eetfestijn@ttcdepinte.be">eetfestijn@ttcdepinte.be</a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_7"></div>
                    <h3>Jan Vanmarsnille</h3>
                    <p>Jeugdverantwoordelijke (training), tornooien</p>
                    <p>GSM : 0499/86.49.10</p>
                    <p>E-mailadres: <a href="mailto:jeugdverantwoordelijke@ttcdepinte.be">jeugdverantwoordelijke@ttcdepinte.be</a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_8"></div>
                    <h3>Pascal De Zutter</h3>
                    <p>Adjunct communicatieverantwoordelijke/secretariaat</p>
                    <p>GSM : 0469/10 77 07</p>
                    <p>E-mailadres: <a href="mailto:adjunct@ttcdepinte.be">adjunct@ttcdepinte.be</a></p>
                </div>
                <div class="board-member">
                    <div class="js-image" data-img-key="board_9"></div>
                    <h3>Steven De Prest</h3>
                    <p>Interclubleider</p>
                    <p>GSM : 0474/88.43.62</p>
                    <p>E-mailadres: <a href="mailto:interclub@ttcdepinte.be">interclub@ttcdepinte.be</a></p>
                </div>
            </div>
        </div>
    </div>
    <footer class="contact-footer" id="contact">
        <div class="footer-container">
            <!-- Contact Form Section -->
            <div class="footer-contact">
                <h3>Send Us a Message</h3>
                <form action="/send_message" method="POST">
                    <label for="name">Your Name:</label>
                    <input type="text" id="name" name="name" placeholder="Enter your name" required>

                    <label for="email">Your Email:</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" required>

                    <label for="message">Your Message:</label>
                    <textarea id="message" name="message" rows="6" placeholder="Write your message here" required></textarea>

                    <button type="submit">Send Message</button>
                </form>
            </div>

            <!-- Google Maps Section -->
            <div class="footer-map">
                <h3>Find Us</h3>
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1085.0589839788765!2d3.6434704583243533!3d50.99113426613226!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47c3728f5ea7087d%3A0xcecf1e7d9ec33a94!2sPolderbos%2020%2C%209840%20De%20Pinte!5e0!3m2!1sen!2sbe!4v1734190974998!5m2!1sen!2sbe"
                    width="100%"
                    height="300px"
                    style="border:0;"
                    allowfullscreen=""
                    loading="lazy">
                </iframe>
            </div>
        </div>
    </footer>

    <script>
        // IMAGE_CONFIG will be set by the server
        IMAGE_CONFIG = {};
        console.log("Script loaded, fetching image config...");

        // Fetch config and initialize images
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/image-config')
              .then(response => response.json())
              .then(config => {
                IMAGE_CONFIG = config;

                // Load images
                document.querySelectorAll('.js-image').forEach(placeholder => {
                  const key = placeholder.dataset.imgKey;
                  const cfg = IMAGE_CONFIG[key];

                  if (!cfg) {
                    console.warn(`No IMAGE_CONFIG entry for key “${key}”`);
                    return;
                  }

                  const img = new Image();
                  img.alt = cfg.alt || '';

                  // Preserve original attribute setting
                  for (const [name, value] of Object.entries(cfg.attrs || {})) {
                    img.setAttribute(name, value);
                  }

                  img.onload = () => placeholder.appendChild(img);
                  img.onerror = () => console.warn(`Image failed to load: ${cfg.src}`);
                  img.src = cfg.src;
                });
              })
            .catch(error => console.error('Error loading image config:', error));

            // Handle login navigation
            document.querySelectorAll('.auth-button.login').forEach(button => {
                button.addEventListener('click', () => {
                    window.location.href = '/login';
                });
            });

            // Handle register navigation
            document.querySelectorAll('.auth-button.register').forEach(button => {
                button.addEventListener('click', () => {
                    window.location.href = '/register';
                });
            });

            // Handle home navigation
            const homeButton = document.querySelector('.nav-links a[href="#home"]');
            if (homeButton) {
                homeButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    window.location.href = '/';
                });
            }

            // Handle contact navigation
            const contactButton = document.querySelector('.nav-links a[href="#contact"]');
            if (contactButton) {
                contactButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    handleNavigation('contact');
                });
            }

            // Handle info navigation
            const infoButton = document.querySelector('.nav-links a[href="#info"]');
            if (infoButton) {
                infoButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    handleNavigation('info');
                });
            }

            // Handle training navigation
            const trainingButton = document.querySelector('.nav-links a[href="#training"]');
            if (trainingButton) {
                trainingButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    handleNavigation('training');
                });
            }

            // Handle competition navigation
            const competitionButton = document.querySelector('.nav-links a[href="#competition"]');
            if (competitionButton) {
                competitionButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    handleNavigation('competition');
                });
            }

            // Handle news navigation
            const newsButton = document.querySelector('.nav-links a[href="#news"]');
            if (newsButton) {
                newsButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    handleNavigation('news');
                });
            }

            // Function to handle navigation
            function handleNavigation(sectionId) {
                if (window.location.pathname === '/' || window.location.pathname.endsWith('home.html')) {
                    // Scroll smoothly to the section if on the home page
                    const section = document.getElementById(sectionId);
                    if (section) {
                        const headerHeight = document.querySelector('.header-container')?.offsetHeight || 0;
                        const targetTop = section.getBoundingClientRect().top + window.pageYOffset - headerHeight;
                        window.scrollTo({ top: targetTop, behavior: 'smooth' });
                    }
                } else {
                    // Redirect to the home page with the section hash
                    window.location.href = `/#${sectionId}`;
                }
            }

            // Load top activities
            const topActivitiesContainer = document.getElementById('top-activities');

            async function loadBottomActivities() {
                const response = await fetch(`/api/top-activities`)
                const activities = await response.json();

                activities.sort((a, b) => new Date(a.date) - new Date(b.date));
                const bottomActivities = activities.slice(0, 3);

                bottomActivities.forEach(activity => {
                    const activityElement = document.createElement('a');
                    activityElement.className = 'activity-item';
                    activityElement.href = `/activities#${activity.id}`;

                    // Create temporary element to extract text
                    const temp = document.createElement('div');
                    temp.innerHTML = activity.details;
                    const plainText = temp.textContent || temp.innerText || '';

                    activityElement.innerHTML = `
                        <div class="date">${activity.date}</div>
                        <h3>${activity.name}</h3>
                        <p>${truncateDescription(plainText, 50)}</p>
                    `;
                    topActivitiesContainer.appendChild(activityElement);
                });
            }

            function truncateDescription(description, length) {
                if (description.length > length) {
                    return description.substring(0, length) + '...';
                }
                return description;
            }

            loadBottomActivities();

            // Initialize image size from saved setting
            async function initImageSize() {
              try {
                const response = await fetch('/image_size');
                const sizes = await response.json();

                const savedSize = sizes?.home || 'medium';

                // Apply the saved size
                updateImageSize(savedSize);
              } catch (e) {
                console.error("Failed to fetch saved image size:", e);
                updateImageSize("medium");
              }
            }

            function updateImageSize(mode) {
              switch (mode) {
                case "small":
                  document.documentElement.style.setProperty("--image-max-size", "150px");
                  break;
                case "medium":
                  document.documentElement.style.setProperty("--image-max-size", "300px");
                  break;
                case "big":
                  document.documentElement.style.setProperty("--image-max-size", "100%");
                  break;
              }
            }

            initImageSize();
        });
    </script>
</body>
</html>